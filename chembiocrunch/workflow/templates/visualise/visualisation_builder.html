{% extends "workflow_base.html" %}
{% load crispy_forms_tags %}

{% block action_title %}
{% if not visualisation_id %}
Adding a new Visualisation
{% else %}
Editing Visualisation - {% if visualisation.visualisation_title %}{{ visualisation.visualisation_title|title }}{% else %} no title yet{% endif %}
{% endif %}


{% endblock action_title %}



{% block help_text %}
<p>
        The visualisation builder lets you create, save and export multiple visualisations
</p>
<form    action="" class="  " method="post">
{% if visualisation_id %}

         <button type="submit" value="new" name="new" id="submit-id2-submit"  class="btn btn-success"><span class="glyphicon glyphicon-plus"></span>Save changes and create new</button>
    {% else %}


{% endif %}
 <button type="submit"  id="submit-id3-submit"  class="btn btn-primary"><span class="glyphicon glyphicon-refresh"></span>Save changes and continue editing</button>

 <button type="submit"  id="submit-id3-submit" value="delete" name="delete" class="btn btn-danger"><span class="glyphicon glyphicon-remove"></span>Discard visualisation and restart</button>

{% endblock help_text %}
{% block content %}
  

{% if visualisation_list %}
    <div class='row'>
    {% for visualisation_item in visualisation_list %}
        <a id="carousel-selector-{{ visualisation_item.id }}" href="{% url 'visualisation_update_view' pk=object.id workflow_revision_id=workflow_revision.id visualisation_id=visualisation_item.id %}">
        <div class ="btn col-lg-2 col-md-2 col-sd-4 col-xs-6 "><div class="well col-sd-10 col-sd-offset-1 {% ifequal visualisation_item.id visualisation.id %} activeitem {% endifequal %}"><span class="workflow-title">{% if visualisation_item.visualisation_title %}{{ visualisation_item.visualisation_title|title }}{% else %} no title yet{% endif %}</span><br/><br/><span class="workflow-date">{{ visualisation_item.created }}</span></div></div> 
        </a>
    {% endfor %}
</div><!-- end vis holder -->
{% endif %}

    <div class="row">
        <div class="col-md-12" id="slider">
            
                <div id="carousel-bounding-box">
                    <div id="myCarousel" class="carousel slide">
                        <!-- main slider carousel items -->
                        <div class="carousel-inner">
                             <div class="active item" data-slide-number="0">
                               
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 crispy form-horizontal">
                                    {% crispy visualisation_form visualisation_form.helper %}
                                </div>
                                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                                    {{ visualisation.html|safe }}
                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3 crispy form-horizontal">
                                    {% crispy visualisation_form visualisation_form.filterhelper %}
                                    Numeric fields coming soon
                                </div>
                                </form>
                            </div>
                        </div>
                        <!-- main slider carousel nav controls <a class="carousel-control left" href="#myCarousel" data-slide="prev">‹</a>

                        <a class="carousel-control right" href="#myCarousel" data-slide="next">›</a>--> 
                    </div>
                </div>

        </div>
    </div>




{% endblock content %}


{% block extra_js %}
<script>
$.fn.xml = function() {
    if (typeof window.XMLSerializer != "undefined") {
        return (new window.XMLSerializer()).serializeToString(this[0]);
    } else if (typeof xmlNode.xml != "undefined") {
        return this[0].xml;
    }
    return "";
    //(new XMLSerializer()).serializeToString(this[0]);
};

$.fn.DOMRefresh = function() {
    return $($(this.xml()).replaceAll(this));
};

$( document ).ready(function() {
    $(window).load(function() {
var backendheight= "0";
var backendwidth = "0";
var items = $(".mpld3-figure");
if (items instanceof Array){
    backendheight = items[0].attr("height");
    backendwidth = items[0].attr("width");

}else {
    backendheight = items.attr("height");
    backendwidth = items.attr("width");
}
items.attr("preserveAspectRatio", "xMinYMin slice");
items.attr("viewBox", "0 0 "+ backendwidth + " " backendheight);
items.attr("x", "100%");
items.attr("y", "100%");
items.attr("height", "100%");
items.attr("width", "100%");
items.attr("version", "1.1");
items.DOMRefresh();
//items.parent().html=$(".mpld3-figure").parent().html;

});
});
</script>
{% endblock extra_js %}

